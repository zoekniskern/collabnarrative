<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>POC Collab Narrative</title>
    <meta charset="utf-8">
    <style>
        .row {
            display: flex;
            flex-direction: row;
        }
        #savedResponses {
            width: 40%;
            border: 3px solid gray;
            margin: 5px;
            padding: 5px;
        }
        .response {
            padding: 0px 5px 0px 5px;
            width: 95%;
            border: 1px solid lightgray;
            display: flex;
            justify-content: space-between;
        }
    </style>
  </head>
  <body>
        <div id="prompt">
        </br>
            <h5>PROMPT</h5>
            <!-- <label>Color of Hood:</label><br/> -->
            <p> Once upon a time there was a little
                <select id='gender'>
                    <option>girl</option>
                    <option>boy</option>
                </select>
                who lived in a
                <select id='home'>
                    <option>village</option>
                    <option>castle</option>
                    <option>prison</option>
                </select> 
                near a 
                <select id='setting'>
                    <option>forest</option>
                    <option>jungle</option>
                    <option>desert</option>
                </select>
                .
                Whenever the <span class="curGen"></span> went out, they wore a
                <select id='colors'>
                    <option>red</option>
                    <option>blue</option>
                    <option>green</option>
                </select>
                riding cloak, so everyone in the <span class="curHome"></span> called them
                <span>
                    <input id="name" type="text" name="name" placeholder="Little Red Riding Hood">
                    <button onclick="updateName()" value="save name">Save Name</button>
                </span>
            </p>
        </div>
        </br>
        <div id="response">
            <h5>WRITE YOUR OWN ENDING:</h5>
            <textarea id='responseText' name="responseText" cols="40" rows="5"></textarea>
            <button onclick="addResponse()" value="save name">Save Response</button>
        </div>
        </br>
        <div id='canvasContainer'>
            <canvas id="mainCanvas" width="500" height="10">
                    Please update your browser!
            </canvas>
        </div>
        <div class='row'>
            <h5>SAVED RESPONSES</h5>
            <div id="savedResponses">
                    <!-- SHOW CURRENT ATTRIBUTES FOR TESTING -->
            </div>
            <div id="attrCur">
                <!-- SHOW CURRENT ATTRIBUTES FOR TESTING -->
                <h5>FOR TESTING PURPOSES</h5>
                <p>current gender: <span class="curGen"></span></p>
                <p>current color: <span class="curCol"></span></p>
                <p>current home: <span class="curHome"></span></p>
                <p>current setting: <span class="curSet"></span></p>
                <p>current name: <span class="curName"></span></p>
            </div>
        </div>
    </body> 
    <!-- <script src='./main.js'></script> -->
    <!-- <script src='./table.js'></script> -->
    <script type="text/javascript">
        window.onload = function() {
            init();
        };

        //Global Variables
        var canvas;
        var ctx;
        var color;
        var gender;
        var home;
        var setting;
        var basketContents;
        var wolf;
        var name;

        var colorList;
        var genderList;
        var homeList;
        var settingList;
        var basketList;
        var wolfList;
        var nameList;

        //SAVING PROMPTS
        var allResponses = [];
        var promptIdCounter = 0;
        var responseDiv = document.querySelector('#savedResponses');
        
        //Constant Variables
        var default_color = 'red';
        var default_gender = "girl";
        var default_home = 'village';
        var default_setting = 'forest';
        var default_basketContents = 'muffins';
        var default_wolf = "wolf";
        var default_name = 'Little Red Riding Hood';

        //var parentDiv = document.querySelector('#attrCur');
        //LIST OF ALL MENTIONS OF VARIABLES
        colorList = document.getElementsByClassName("curCol");
        genderList = document.getElementsByClassName("curGen");
        homeList = document.getElementsByClassName("curHome");
        settingList = document.getElementsByClassName("curSet");
        basketList = document.getElementsByClassName("curBask");
        wolfList = document.getElementsByClassName("curWolf");
        nameList = document.getElementsByClassName("curName");

        //ADDING EVENT HANDLERS FOR THE VARIABLES
        document.querySelector('#colors').onchange = function(e){
                color = e.target.value;
                ctx.fillStyle = color;
                //drawback();
                updateCurAttributes();
                console.log("fillStyle = " + color);
        }

        document.querySelector('#gender').onchange = function(e){
                gender = e.target.value;
                updateCurAttributes();
                console.log("gender = " + gender);
        }

        document.querySelector('#home').onchange = function(e){
                home = e.target.value;
                updateCurAttributes();
                console.log("home = " + home);
        }

        document.querySelector('#setting').onchange = function(e){
                setting = e.target.value;
                updateCurAttributes();
                console.log("setting = " + setting);
        }

        //INIT
        function init(){
            canvas = document.querySelector('#mainCanvas');
            ctx = canvas.getContext('2d');
            color = default_color;
            gender = default_gender;
            home = default_home;
            setting = default_setting;
            name = default_name;

            //setting canvas variables
            ctx.fillStyle = color;
            updateCurAttributes();
            //drawback();
            //createDiv(color, 'color');
            //createDiv(gender, 'gender');

            update();
        }
        
        //Square for testing
        function drawback(){
            ctx.fillRect(0,0,canvas.width, canvas.height);
        }

        //ANIMATION
        function update(){
            drawback();
            requestAnimationFrame(update);

            //drawResponses();
            //createDiv(color, 'color');
            //createDiv(gender, 'gender');
        }

        //ADDING HTML TO DOC
        function createDiv(parent, attr, likes, id){
            var div = document.createElement('div');
            // div.onclick = function(){
            //     allResponses[id].likes++;
            //     document.getElementById(this.id).innerHTML = allResponses[id].likes;
            // }
            div.className = 'response';
            var p1 = document.createElement('p');
            p1.innerHTML = attr;
            var p2 = document.createElement('p');
            p2.className = id + 'likes';
            p2.innerHTML = likes;
            p2.onclick = function(){
                allResponses[id].likes++;
                //document.getElementById(this.id).innerHTML = allResponses[id].likes;
                console.log(allResponses[id]);
            }

            div.appendChild(p1);
            div.appendChild(p2);
            
            parent.appendChild(div);
        }

        //ADDING HTML TO DOC attempt 2
        function updateCurAttributes(){
            // var g = document.querySelector('.curGen');
            // var c = document.querySelector('.curCol');

            // g.innerHTML = gender;
            // c.innerHTML = gender;

            //console.dir(colorList);

            //Colors
            for(var i=0; i < colorList.length; i++){
                colorList[i].innerHTML = color;
            }
            //Genders
            for(var i=0; i < genderList.length; i++){
                genderList[i].innerHTML = gender;
            }

            //Home
            for(var i=0; i < homeList.length; i++){
                homeList[i].innerHTML = home;
            }

            //Setting
            for(var i=0; i < settingList.length; i++){
                settingList[i].innerHTML = setting;
            }

            //Name
            for(var i=0; i < nameList.length; i++){
                nameList[i].innerHTML = name;
            }
        }

        //Updating the name
        function updateName() {
            name = document.getElementById('name').value;
            console.log('name: ' + name);

            //Name
            for(var i=0; i < nameList.length; i++){
                nameList[i].innerHTML = name;
            }
        }

        //RESPONSE HANDLING CODE
        function Response(id,text, time, likes) {
            this.id = id;
            this.text = text;
            this.time = time;
            this.likes = likes;
        }

        function addResponse(){
            var input = document.getElementById('responseText').value;
            var when = new Date();
            var likes = 0;

            newResponse = new Response(promptIdCounter,input, when, likes);
            allResponses.push(newResponse);

            createDiv(responseDiv,input,likes,promptIdCounter);

            //console.dir(allResponses);
            //drawResponses();
            promptIdCounter++;
            document.getElementById('responseText').value = "";
        }

        /*
        function drawResponses(){
            responseDiv.innerHTML = "";

            for(var o; o < allResponses.length + 1; o++){
                var o_text = allResponses[o].text;
                var o_likes = allResponses[o].likes;
                var o_id = allResponses[o].id;
                createDiv(responseDiv,o_text,o_likes,o_id);
            }

            console.log('draw response ran');
            console.dir(allResponses);
        }
        */
    </script>
</html>
